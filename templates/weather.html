{% extends "base.html" %}

{% block title %}å¤©æ°—æƒ…å ± - {{ super() }}{% endblock %}

{% block content %}
<div class="search-section">
    <form method="POST" action="{{ url_for('weather') }}" class="search-form">
        <div class="input-group">
            <input type="text" 
                   name="city" 
                   placeholder="éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: Tokyo, London, æ±äº¬ï¼‰" 
                   value="{{ request.form.city or '' }}"
                   class="search-input"
                   required>
            <button type="submit" class="search-button">ğŸ” å¤©æ°—ã‚’èª¿ã¹ã‚‹</button>
        </div>
        <div class="suggestions">
            <span class="suggestion-label">äººæ°—ã®éƒ½å¸‚:</span>
            <button type="button" class="suggestion-btn" onclick="searchCity('Tokyo')">æ±äº¬</button>
            <button type="button" class="suggestion-btn" onclick="searchCity('Osaka')">å¤§é˜ª</button>
            <button type="button" class="suggestion-btn" onclick="searchCity('London')">ãƒ­ãƒ³ãƒ‰ãƒ³</button>
            <button type="button" class="suggestion-btn" onclick="searchCity('New York')">ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯</button>
            <button type="button" class="suggestion-btn" onclick="searchCity('Paris')">ãƒ‘ãƒª</button>
        </div>
    </form>
</div>

{% if weather_data %}
<div class="weather-display" id="weatherResult">
    <div class="weather-header">
        <h2>{{ weather_data.city_name }}, {{ weather_data.country }} ã®å¤©æ°—</h2>
        <div class="timestamp">
            ğŸ“… {{ weather_data.timestamp.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }} æ›´æ–°
        </div>
    </div>
    
    <div class="weather-main">
        <div class="weather-icon-section">
            <div class="weather-icon">
                {% if 'clear' in weather_data.description_en.lower() %}
                    â˜€ï¸
                {% elif 'cloud' in weather_data.description_en.lower() %}
                    â˜ï¸
                {% elif 'rain' in weather_data.description_en.lower() %}
                    ğŸŒ§ï¸
                {% elif 'drizzle' in weather_data.description_en.lower() %}
                    ğŸŒ¦ï¸
                {% elif 'thunderstorm' in weather_data.description_en.lower() %}
                    â›ˆï¸
                {% elif 'snow' in weather_data.description_en.lower() %}
                    â„ï¸
                {% elif 'mist' in weather_data.description_en.lower() or 'fog' in weather_data.description_en.lower() %}
                    ğŸŒ«ï¸
                {% else %}
                    ğŸŒ¤ï¸
                {% endif %}
            </div>
            <div class="description">{{ weather_data.description }}</div>
        </div>
        
        <div class="temperature-section">
            <div class="main-temp">{{ weather_data.temperature }}Â°C</div>
            <div class="feels-like">ä½“æ„Ÿæ¸©åº¦ {{ weather_data.feels_like }}Â°C</div>
        </div>
    </div>
    
    <div class="weather-details">
        <div class="detail-grid">
            <div class="detail-item">
                <div class="detail-icon">ğŸ’§</div>
                <div class="detail-label">æ¹¿åº¦</div>
                <div class="detail-value">{{ weather_data.humidity }}%</div>
            </div>
            
            <div class="detail-item">
                <div class="detail-icon">ğŸˆ</div>
                <div class="detail-label">æ°—åœ§</div>
                <div class="detail-value">{{ weather_data.pressure }} hPa</div>
            </div>
            
            {% if weather_data.wind_speed %}
            <div class="detail-item">
                <div class="detail-icon">ğŸ’¨</div>
                <div class="detail-label">é¢¨é€Ÿ</div>
                <div class="detail-value">{{ weather_data.wind_speed }} m/s</div>
            </div>
            {% endif %}
            
            {% if weather_data.visibility %}
            <div class="detail-item">
                <div class="detail-icon">ğŸ‘ï¸</div>
                <div class="detail-label">è¦–ç¨‹</div>
                <div class="detail-value">{{ (weather_data.visibility / 1000) | round(1) }} km</div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="action-buttons">
        <button onclick="refreshWeather()" class="refresh-btn">ğŸ”„ æ›´æ–°</button>
        <button onclick="shareWeather()" class="share-btn">ğŸ“¤ å…±æœ‰</button>
    </div>
</div>
{% endif %}

<div class="info-section">
    <h3>ğŸ’¡ ä½¿ã„æ–¹</h3>
    <ul>
        <li>ä¸Šè¨˜ã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</li>
        <li>è‹±èªï¼ˆTokyo, Londonï¼‰ã¾ãŸã¯æ—¥æœ¬èªï¼ˆæ±äº¬ã€å¤§é˜ªï¼‰ã§å…¥åŠ›ã§ãã¾ã™</li>
        <li>äººæ°—ã®éƒ½å¸‚ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç´ æ—©ãæ¤œç´¢ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™</li>
        <li>å¤©æ°—æƒ…å ±ã¯ OpenWeatherMap API ã‹ã‚‰å–å¾—ã—ã¦ã„ã¾ã™</li>
    </ul>
</div>

<style>
.search-section {
    margin-bottom: 30px;
}

.search-form {
    text-align: center;
}

.input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.search-input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
}

.search-input:focus {
    border-color: #4CAF50;
}

.search-button {
    padding: 12px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.search-button:hover {
    background-color: #45a049;
}

.suggestions {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 8px;
}

.suggestion-label {
    color: #666;
    margin-right: 10px;
}

.suggestion-btn {
    padding: 6px 12px;
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
}

.suggestion-btn:hover {
    background-color: #e0e0e0;
    border-color: #4CAF50;
}

.weather-display {
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    color: white;
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.weather-header {
    text-align: center;
    margin-bottom: 25px;
}

.weather-header h2 {
    margin: 0 0 10px 0;
    font-size: 24px;
    font-weight: 600;
}

.timestamp {
    opacity: 0.9;
    font-size: 14px;
}

.weather-main {
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 20px;
}

.weather-icon-section {
    text-align: center;
}

.weather-icon {
    font-size: 80px;
    margin-bottom: 10px;
}

.description {
    font-size: 18px;
    font-weight: 500;
}

.temperature-section {
    text-align: center;
}

.main-temp {
    font-size: 48px;
    font-weight: 700;
    margin-bottom: 5px;
}

.feels-like {
    font-size: 16px;
    opacity: 0.9;
}

.weather-details {
    margin-bottom: 20px;
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
}

.detail-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    backdrop-filter: blur(10px);
}

.detail-icon {
    font-size: 24px;
    margin-bottom: 8px;
}

.detail-label {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 5px;
}

.detail-value {
    font-size: 18px;
    font-weight: 600;
}

.action-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.refresh-btn, .share-btn {
    padding: 10px 20px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
    backdrop-filter: blur(10px);
}

.refresh-btn:hover, .share-btn:hover {
    background: rgba(255,255,255,0.3);
    border-color: rgba(255,255,255,0.5);
}

.info-section {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-top: 30px;
}

.info-section h3 {
    margin-top: 0;
    color: #333;
}

.info-section ul {
    margin: 15px 0;
    padding-left: 20px;
}

.info-section li {
    margin-bottom: 8px;
    line-height: 1.5;
}

@media (max-width: 768px) {
    .input-group {
        flex-direction: column;
    }
    
    .weather-main {
        flex-direction: column;
        text-align: center;
    }
    
    .main-temp {
        font-size: 36px;
    }
    
    .weather-icon {
        font-size: 60px;
    }
    
    .detail-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
function searchCity(cityName) {
    document.querySelector('input[name="city"]').value = cityName;
    document.querySelector('.search-form').submit();
}

function refreshWeather() {
    const currentCity = '{{ weather_data.city_name if weather_data else "" }}';
    if (currentCity) {
        searchCity(currentCity);
    }
}

function shareWeather() {
    const weatherData = {{ weather_data.to_dict() | tojson if weather_data else '{}' }};
    if (weatherData.city_name) {
        const shareText = `${weatherData.city_name}ã®å¤©æ°—: ${weatherData.description} ${weatherData.temperature}Â°C`;
        if (navigator.share) {
            navigator.share({
                title: 'å¤©æ°—æƒ…å ±',
                text: shareText,
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(shareText).then(() => {
                alert('å¤©æ°—æƒ…å ±ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }
    }
}

// æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼å¯¾å¿œ
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            document.querySelector('.search-form').submit();
        }
    });
});
</script>
{% endblock %}